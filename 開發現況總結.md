「今天吃什麼？」App 開發現況總結 (v3.0)
=======================================

這是一份為了讓接手的開發者或 AI 協作者能快速理解專案而撰寫的文件。本文件將概述專案的核心需求、技術架構，以及從原型至今各階段的主要更新。

**一、 專案核心需求 (Core Requirements)**
* **互動式地圖探索**: 讓使用者在真實地圖上，透過拖曳手把直觀地「畫」出一個圓形的美食探索半徑。
* **智慧美食分類**: 自動抓取範圍內的所有餐廳，並透過後端 AI 進行智慧分類。
* **沉浸式探索流程**: 無縫地瀏覽店家列表與地圖資訊，不應有頻繁的頁面跳轉來打斷體驗。
* **充滿儀式感的決策工具**: 提供「命運羅盤」等模式，幫助使用者做出最終決定。

**二、 v1.0 -> v2.0 階段回顧**
此階段的核心是將 App 從一個使用模擬數據的原型，進化為一個**完整串接真實世界 API 的 Web App**。包含了 Google Maps API 的真實數據獲取、Gemini API 的智慧分類、以及安全的金鑰管理。

---

### **三、 近期主要更新 (v3.0) - 架構重構與開發流程優化**

此階段的核心任務是**提升程式碼品質與可維護性**，並**徹底解決開發環境的痛點**。

**1. 前端：從單體檔案到現代模組化 (Frontend: Monolith to Modules)**
* **動機**：原有的 `js/app.js` 檔案隨著功能增加而變得過於龐大，難以維護與擴展。
* **重構執行**：
    * **全面模組化**：將 `js/app.js` 拆分為七個職責明確的 ES6 模組：
        * `main.js`: 應用程式主入口，負責初始化與綁定事件。
        * `state.js`: 集中管理所有共享狀態 (State) 與 DOM 元素參照。
        * `navigation.js`: 處理所有頁面切換邏輯。
        * `api.js`: 封裝所有對後端 `/api/search` 的 fetch 請求。
        * `map.js`: 專門處理所有 Leaflet 地圖相關的操作（初始化、標記、繪圖等）。
        * `ui.js`: 負責所有 DOM 的渲染與更新邏輯。
        * `handlers.js`: 存放所有事件處理函式 (Event Handlers)。
    * **啟用模組系統**：修改 `index.html`，將 script 標籤改為 `<script type="module" src="./js/main.js">` 來載入新的模組化架構。

**2. 後端與 AI：功能增強與服務整合 (Backend & AI: Enhancements & Integration)**
* **AI 動態圖示**：優化了 `app.py` 中傳遞給 Gemini API 的 Prompt，指示 AI 在回傳分類名稱時，直接附加一個最貼切的 Emoji。這使得前端不再需要維護一個靜態的 `categoryIcons` 對照表，實現了完全動態的圖示系統。
* **整合前端服務**：為了解決 `type="module"` 在 `file:///` 協議下的 CORS 安全限制，對 Flask 伺服器進行了擴充。
    * 在 `app.py` 中，透過設定 `static_folder` 並新增根路由 (`@app.route('/')`)，使 Flask **同時擔任 API 後端與前端靜態檔案伺服器**的角色。
    * **成果**：開發流程被大幅簡化，現在只需 `python app.py` 一個指令即可啟動整個應用，並透過 `http://127.0.0.1:5000` 進行訪問，徹底解決了跨來源請求問題。
* **API 穩定性修復**：根據運行時的 Traceback，修正了 `gmaps.place` API 呼叫中 `fields` 參數的命名錯誤（`'photos'` -> `'photo'`, `'types'` -> `'type'`），解決了導致 500 內部伺服器錯誤的 Bug。

**四、 未來開發方向 (Future Development)**
(經本次重構後，架構更穩固，未來可專注於功能擴展)
* **數據持久化**: 使用 `localStorage` 讓使用者的「候選清單」在重新整理後依然存在。
* **性能優化**: 當範圍內餐廳過多時，地圖上的標記點可能影響效能。可研究引入 **Marker Clustering** (標記點聚合) 技術。
* **PWA (Progressive Web App)**: 增加 Manifest 和 Service Worker，讓使用者可以將 Web App 「安裝」到手機主畫面上。