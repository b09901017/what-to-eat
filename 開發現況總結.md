# 今天吃什麼？ What To Eat Today?

一款旨在解決日常「用餐選擇困難症」的 Web App。透過互動式地圖探索、AI 智慧分類與充滿儀式感的決策工具，提供充滿質感與樂趣的美食探索體驗。

## ✨ 核心功能 (Features)

* **📍 互動式地圖探索**: 定位使用者，並在真實地圖上透過拖曳圓心或手把，直觀地「畫」出一個圓形的美食探索半徑。
* **🧠 AI 智慧分類**: 自動抓取範圍內的所有餐廳，並透過後端 Gemini API 進行智慧分類，現在更能動態產生最貼切的 Emoji 圖示！
* **🗺️ 地圖整合決策**: 除了傳統的命運羅盤，更提供了直接在地圖上，透過候選店家圖標隨機閃爍、聚焦的動畫方式，充滿驚喜地做出決定。
* **🎡 充滿儀式感的決策工具**: 將感興趣的店家加入「候選清單」，並透過一個設計精良、動畫流暢的「命運羅盤」做出最終決定。
* **📖 豐富的店家詳情**: 查看店家的真實照片、使用者評論、完整營業時間、電話、網站等詳細資訊。
* **🛠️ 優雅的控制中心 (Floating Action Hub)**: 將地圖輔助工具（如調整範圍、篩選）整合至一個可展開的浮動按鈕中，最大化地圖視野，同時提供流暢的互動體驗。

---

## **版本演進**

### ===v1===
* 奠定了專案核心 UI/UX 風格，包含配色、字體與基本版面配置。
* 使用 Mock Data 建立了一個可互動的 App 原型。
* 實現了基本的頁面切換與命運羅盤動畫。

### ===v2===
* **真實數據串接**: 後端全面改寫，串接 Google Maps Platform API 與 Google Gemini API，可即時獲取並智慧分類真實世界的餐廳數據。
* **API 金鑰管理**: 引入 .env 檔案來管理 API 金鑰，提升安全性。
* **UI/UX 優化**: 升級地圖圖示，並改善探索圈頁面的操作體驗。

### ===v3===
* **前端架構現代化**: 將原先龐大的 js/app.js 檔案，全面重構為 ES6 模組化架構，大幅提升程式碼的可維護性與擴展性。
* **更智慧的 AI 分類**: 優化後端 AI Prompt，讓 Gemini API 能自動為美食分類附上最適合的 Emoji。
* **開發流程整合**: Flask 伺服器整合了前端靜態檔案託管，解決了 CORS 問題，實現 `python app.py` 一鍵啟動。
* **API 穩定性修正**: 修正了 Google Maps Place API 的 `fields` 參數錯誤。

### ===v4===
* **強大的複合式搜尋**: 後端採用寬泛類型 + 精準關鍵字的複合式搜尋策略，並結合分頁處理，能最大化地搜尋到區域內所有相關的美食店家，大幅減少遺漏。
* **整合式篩選功能**: 在美食地圖頁新增了設計精美的篩選面板，可依「目前營業中」、「價位」、「評分」進行多重條件篩選。
* **多行類別佈局**: 優化了美食分類區的顯示方式，改為兩行或三行的橫向滾動佈局，既解決了分類過多時的瀏覽問題，也避免了遮擋地圖視野。
* **使用者體驗優化**: 大幅提升了「探索圈」頁面拖曳手把的靈敏度。美化了「回到中心」按鈕的 UI 設計，使其更符合整體風格。

### ===v5===
* **後端架構升級**: 將單一搜尋 API 重構為 `/api/find_places` 和 `/api/categorize_places` 兩個獨立端點，並引入 Blueprint 機制來組織 API 路由。
* **前端互動革新 - 單擊聚焦**: 簡化了美食地圖頁的核心互動，只需單擊即可多選或取消類別，實現即時的地圖篩選與下方按鈕的透明度變化。
* **UI/UX 精緻化**: 新增「重設檢視」按鈕，僅在使用者篩選類別時出現，方便一鍵恢復初始狀態。

### ===v6===
* **沉浸式範圍重設**: 在美食地圖頁新增「調整範圍」功能，無須返回上一頁。點擊後即可在原地圖上進入編輯模式，直接拖曳圓心或手把調整探索圈。
* **精準距離驗證**: 後端導入 `geopy` 函式庫，增加一道伺服器端的距離驗證程序，確保最終顯示的所有店家 100% 位於使用者圈選的範圍內。
* **互動體驗升級**: 探索圈的中心點現在也可以拖曳，讓使用者能更自由、更直觀地微調搜尋位置。
* **穩定性修復**: 修正了因外部資源路徑錯誤導致地圖函式庫載入失敗的問題。

### ===v7===
* **UI/UX 核心重塑 - Floating Action Hub**: 將「調整範圍」、「重設檢視」、「篩選」等輔助功能整合至一個位於地圖右下角的 Floating Action Hub 中，大幅簡化了介面。
* **動態層次感佈局**: 當使用者點擊某個美食分類時，該分類下的店家預覽清單會從下方滑出，並動態地將上方的標題與 Floating Action Hub 向上推移。
* **功能增強與流程優化**: 新增「查看候選」面板，並將底部的主按鈕重新命名為更有趣的「隨便啦 !」，專注於引導至「命運羅盤」。
* **穩定性與細節修復**: 解決了 JavaScript 的循環依賴問題，並修正了多項 CSS Bug。

### ===v8===
* **使用者體驗全面優化 (UX Overhaul)**: 啟用 GPS 優先定位模式，為地圖加入路名圖層。
* **地圖互動升級**: 點擊美食類別或店家時，地圖會自動平移聚焦至視覺中心。將標記動畫改為更柔和的縮放效果，並解決了動畫與地圖縮放的渲染衝突。
* **「調整範圍」模式重構**: 重新設計了該模式的底部 UI，進入此模式時，地圖會自動縮放至完整顯示探索圈的視野。

### ===v9===
* **地圖整合決策**: 新增了全新的隨機決定模式。在候選清單中點擊決定後，地圖上的候選店家標記會開始隨機閃爍，速度由快到慢，最終停留在獲勝店家上，提供更具沉浸感的視覺化決策體驗。
* **UI 流程重構**: 將傳統的「命運羅盤」功能移入 Floating Action Hub 中。底部主按鈕則改為「查看候選店家」，並在其右上角顯示當前候選數量，流程更直觀。

### ===v10===
* **決策體驗精緻化**:
    * 在地圖隨機決定前，會自動過濾非候選店家，讓使用者能完全專注於決策動畫。
    * 重新設計了「查看候選店家」按鈕的計數器樣式，使其與按鈕本身更完美地融合。
    * 修正了決策動畫結束後，獲勝店家的發光狀態會殘留的問題。現在點擊「重新選擇」後，地圖會完全恢復至決策前的狀態。

### ===v11===
* **UI/UX 精緻化 & 體驗重構**:
    * **篩選面板重構**: 徹底解決了關閉按鈕與選項重疊的問題，並為面板新增標題，使結構更清晰。
    * **詳情頁返回按鈕改造**: 將返回按鈕從不明顯的文字符號，升級為清晰的向量 (SVG) 箭頭圖示，並採用毛玻璃風格，確保在任何背景下都清晰可見。
    * **地圖互動核心升級**: 在 Floating Hub 新增「回到探索中心」功能。並重構了地圖的置中邏輯，確保所有「聚焦」操作都會將目標點定位在無遮擋的可視區域中心。

### ===v12===
* **Render 部署適應性改造**:
    * **後端部署優化**: 移除 `app.py` 中的 `app.run()`，使其能透過 Gunicorn 等 WSGI 伺服器進行部署。
    * **前端 API 路徑中心化**: 新增 `js/config.js` 檔案，將 API 的基礎 URL 統一管理。
    * **前端 API 請求重構**: 更新 `js/api.js`，使其所有請求都基於 `config.js` 中定義的 `API_BASE_URL`。

### ===v13===
* **地圖互動體驗終極打磨 (Map UX Polish)**:
    * **互動邏輯重構 - 單選模式**: 將美食地圖頁的類別篩選從「複選」改為更直覺的「單選」模式。
    * **地圖控制權回歸**: 全面移除在選擇類別、點擊店家等操作時的地圖自動平移與縮放。
    * **智慧置中與視野最佳化**: 重構了「回到中心」與「首次載入地圖」的視野邏輯，動態偵測 UI 高度並精準計算內邊距。
    * **決策動畫升級**: 重寫了隨機決策的動畫計時系統，實現了長達 7 秒、由快至慢、絲滑流暢的視覺效果。

### ===v14 (美食獻禮)===
* **核心架構重構 - 漸進式載入**: 徹底改造了前後端的資料請求流程。現在，使用者在圈選範圍後，後端會**立即**回傳未分類的店家基本資料，前端隨即進入地圖頁面，將初始等待時間從一分多鐘**大幅縮短至 5-7 秒**，從根本上解決了使用者體驗的痛點。
* **非同步 AI 分類 - 「美食獻禮」體驗**:
    * 前端在進入地圖頁的同時，會向後端發送一個**非同步**請求，將店家列表交給 AI 進行背景分類。
    * 在等待期間，地圖上的店家會顯示為可愛的 ✨「待分類」圖示，下方分類列表則會顯示一個正在料理的「AI 大廚」CSS 動畫，將技術上的等待轉化為充滿趣味和期待感的視覺互動。
    * 當 AI 分類完成後，地圖上的 ✨ 圖示會伴隨著動畫**動態變身**為各自的美食 Emoji (🍜, 🍣, 🍔)，下方的分類按鈕也會優雅地**揭曉**，創造出如同「開箱禮物」般的驚喜感。
* **UI/UX 精緻化 & 穩固性提升**:
    * **解決分類閃爍**: 重構了前端邏輯，現在點擊美食類別只會更新樣式，不再觸發整個列表的重繪，互動更流暢。
    * **Popup 狀態同步**: 解決了在 AI 分類完成前點開 Popup，其內容不會自動更新的問題。現在無論何時，Popup 顯示的資訊永遠是最新狀態。
    * **優化提示文字**: Popup 中的提示語會根據 AI 是否正在分類中，動態顯示不同內容，引導更清晰。
    * **新增 AI 分類重試機制**: 當 AI 因網路或其他問題分類失敗時，UI 上會提供一個「再試一次」的按鈕，讓使用者可以主動重新發起分類請求，大幅提升了 App 的穩固性和使用者體驗。
