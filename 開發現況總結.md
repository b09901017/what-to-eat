「今天吃什麼？」App 開發現況總結 (v2.0)
=======================================

這是一份為了讓接手的開發者或 AI 協作者能快速理解專案而撰寫的文件。本文件將概述專案的核心需求、技術架構、從原型到 v2.0 的主要更新。

**一、 專案核心需求 (Core Requirements)**
(此部分與原版本相同，核心目標是解決使用者的日常「用餐選擇困難症」，並提供一個充滿質感與樂趣的探索體驗。)

* **互動式地圖探索**: 讓使用者在真實地圖上，透過拖曳手把直觀地「畫」出一個圓形的美食探索半徑。
* **智慧美食分類**: 自動抓取範圍內的所有餐廳，並透過後端 AI 進行智慧分類。
* **沉浸式探索流程**: 無縫地瀏覽店家列表與地圖資訊，不應有頻繁的頁面跳轉來打斷體驗。
* **充滿儀式感的決策工具**: 提供「命運羅盤」與「地圖隨機選」兩種模式，幫助使用者做出最終決定。

**二、 v1.0 原型架構與亮點回顧**
* **技術架構**:
    * 前端: Vanilla JS (HTML, CSS, JS)，未使用任何框架，地圖功能由 Leaflet.js 實現。
    * 後端: Python Flask，提供 `/api/search` 端點回傳結構完整的模擬數據 (Mock Data)。
* **設計亮點**:
    * **心流式地圖探索體驗**: 實現了地圖與下方預覽卡片的完美連動。
    * **精緻的 UI 與動畫**: 包含模擬真實物理慣性的「命運羅盤」動畫。
    * **清晰的前端程式碼架構**: 使用中央 `state` 物件管理狀態，並將邏輯拆分為 `Maps`, `render`, `handlers` 等物件。

---

### **三、 近期主要更新 (v2.0)**

此階段的核心任務是將 App 與真實世界連接，並根據使用者體驗進行深度優化。

**1. 後端：從模擬到真實 (Backend: Mock to Real)**
* **串接 Google Maps API**:
    * 後端 `app.py` 徹底重構，現在會接收前端傳來的經緯度與半徑。
    * 透過 `googlemaps` Python 客戶端，呼叫 `places_nearby` 搜尋周邊餐廳，再針對每一個地點呼叫 `place` API 獲取包含照片、評論、營業時間在內的詳細資訊。
* **串接 Gemini API 進行智慧分類**:
    * 將從 Google Maps 獲取的餐廳列表（名稱與類型）傳送給 Gemini API (`gemini-1.5-flash` 模型)。
    * 透過精心設計的 Prompt，引導 AI 產生簡潔、通用的分類名稱（如：「日式」、「火鍋」），取代了過去 Mock Data 中較為花俏的命名。
* **安全的金鑰管理**:
    * 引入 `python-dotenv` 套件，將 Google Maps 與 Gemini 的 API 金鑰儲存在 `.env` 檔案中。
    * 專案根目錄新增 `.gitignore` 檔案，明確排除 `.env`，避免將敏感金鑰上傳至版本控制系統。

**2. 前端：功能新增與體驗優化 (Frontend: Features & UX Enhancement)**
* **新增「地圖隨機選」功能**:
    * 為滿足不想手動挑選的使用者，在美食地圖頁新增了「隨機選一家！」按鈕。
    * 其核心動畫邏輯位於 `js/app.js` 的 `handlers.pickRandomRestaurant` 函式。該動畫透過 `setTimeout` 遞迴呼叫，以逐漸拉長間隔時間的方式，實現了所有地圖圖示隨機、由快到慢的閃爍跳動效果，最終停留在選中的目標上。
* **地圖圖示系統升級**:
    * 為了讓地圖資訊更直觀，放棄了原有的彩色圓點標記。
    * 在 `js/app.js` 的 `state` 物件中，建立了一個 `categoryIcons` 映射表，將不同的美食類別對應到一組預先設計好的 SVG 線條圖示。
    * 透過 Leaflet 的 `L.divIcon` 功能，將這些 SVG 字串渲染為地圖上的標記，並用 CSS (`style.css`) 為其添加背景、陰影等樣式，使其更具質感。
* **探索圈頁面操作優化**:
    * **問題**: 原本該頁面的按鈕和拖曳點反應不靈敏，因為被上層的地圖元件遮擋。
    * **解決方案**: 修改 `index.html` 結構，將 UI 控制項（標題、按鈕）放入一個獨立的懸浮層 `.map-ui-overlay` 中。並透過 CSS 的 `pointer-events` 屬性，讓懸浮層的透明區域可以「穿透」，事件能直接傳遞到底層的地圖，而只有按鈕等實體部分能接收點擊，完美解決了操作衝突。

**四、 未來開發方向**
* **數據持久化**: 目前的「候選清單」在重新整理頁面後會消失。未來可以考慮使用 `localStorage` 或引入後端資料庫 (如 SQLite) 來保存使用者的清單。
* **增加更多設定**: 例如允許使用者自訂搜尋的店家類型（如只找咖啡廳）、價格範圍等。
* **PWA (Progressive Web App)**: 增加 Manifest 和 Service Worker，讓使用者可以將這個 Web App 像原生 App 一樣「安裝」到手機主畫面上。